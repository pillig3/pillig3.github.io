/*! For license information please see pentris.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["pentris"],{"./src/index.scss":(e,t,r)=>{r.r(t)},"./src/pentris.tsx":function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),c=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});const i=c(r("./node_modules/react/index.js")),s=r("./node_modules/react/index.js"),l=r("./node_modules/@hot-loader/react-dom/index.js");r("./src/index.scss");const a=(0,s.createRef)();(0,l.render)(i.createElement("canvas",{id:"canvas",className:"full_canvas",tabIndex:0,ref:a}),document.querySelector("#root"));const u=40,d="#D3EDED";var h,f,g,P=!1;const p=a.current,b=p.getContext("2d");window.onresize=T;const w={SmallI:{color:"cyan",shape:[[!0],[!0],[!0],[!0]]},SmallT:{color:"magenta",shape:[[!0,!0,!0],[!1,!0,!1]]},SmallO:{color:"yellow",shape:[[!0,!0],[!0,!0]]},SmallL:{color:"blue",shape:[[!0,!1],[!0,!1],[!0,!0]]},SmallS:{color:"green",shape:[[!1,!0,!0],[!0,!0,!1]]},F:{color:"red",shape:[[!1,!0,!0],[!0,!0,!1],[!1,!0,!1]]},I:{color:"orange",shape:[[!0],[!0],[!0],[!0],[!0]]},L:{color:"lightyellow",shape:[[!0,!1],[!0,!1],[!0,!1],[!0,!0]]},N:{color:"lightgreen",shape:[[!1,!0],[!1,!0],[!0,!0],[!0,!1]]},P:{color:"lightblue",shape:[[!0,!0],[!0,!0],[!0,!1]]},T:{color:"pink",shape:[[!0,!0,!0],[!1,!0,!1],[!1,!0,!1]]},U:{color:"#9f1aff",shape:[[!0,!1,!0],[!0,!0,!0]]},V:{color:"#b3003b",shape:[[!0,!1,!1],[!0,!1,!1],[!0,!0,!0]]},W:{color:"#cc6600",shape:[[!0,!1,!1],[!0,!0,!1],[!1,!0,!0]]},X:{color:"#30b5b5",shape:[[!1,!0,!1],[!0,!0,!0],[!1,!0,!1]]},Y:{color:"#0059b3",shape:[[!0,!0,!0,!0],[!1,!0,!1,!1]]},Z:{color:"#ff667d",shape:[[!0,!0,!1],[!1,!0,!1],[!1,!0,!0]]}},y=B(),m={board:I(14,20,""),fixedBoard:I(14,20,""),currentPiece:y,currentPosition:[6,0],currentShapeGrid:w[y].shape,nextPiece:B(),keysPressed:[],counter:0,waitTime:100,level:0,linesCleared:0,savedPiece:"",score:0,cPressed:!1};function x(e=""){const t=function(){const e={length:0};for(let t=0;t<m.board[0].length;t++){let r=!0;for(let e=0;e<m.board.length;e++)if(""===m.board[e][t]){r=!1;break}r&&(e[t]=!0,e.length++)}return e}();if(t.length>0){switch(m.linesCleared+=t.length,t.length){case 1:m.score+=40*(m.level+1);break;case 2:m.score+=100*(m.level+1);break;case 3:m.score+=300*(m.level+1);break;case 4:m.score+=1200*(m.level+1);break;default:m.score+=6e3*(m.level+1)}m.linesCleared%10==0&&(m.level++,m.waitTime=Math.ceil(Math.max(100-8*m.level,20))),function(e){let t=0;const r={};for(let n=m.board[0].length-1;n>e.length-1;n--)if(0!==t||!0===e[n]){for(!0===e[n]&&!0!==r[n]&&(t++,r[n]=!0);!0===e[n-t];)!0!==r[n-t]?r[n-t]=!0:console.log("!!!The unexpected happened in removeLines()!!!"),t++;for(let e=0;e<m.board.length;e++)m.board[e][n]=m.board[e][n-t]}for(let t=0;t<e.length;t++)for(let e=0;e<m.board.length;e++)m.board[e][t]=""}(t)}m.fixedBoard=K(m.board),""!==e?m.currentPiece=e:(m.currentPiece=m.nextPiece,m.nextPiece=B()),m.currentPosition=[6,0],m.currentShapeGrid=K(w[m.currentPiece].shape),m.cPressed=!1}function S(e){switch(e.code){case"Tab":e.preventDefault();break;case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":case"Space":case"KeyX":case"KeyZ":case"KeyC":m.keysPressed.push(e.code)}}function v(e){"KeyR"===e.code&&(P=!1,document.removeEventListener("keydown",v),document.addEventListener("keydown",S),function(){const e=B();m.board=I(14,20,""),m.fixedBoard=I(14,20,""),m.currentPiece=e,m.currentPosition=[6,0],m.currentShapeGrid=w[e].shape,m.nextPiece=B(),m.keysPressed=[],m.counter=0,m.waitTime=100,m.level=0,m.linesCleared=0,m.savedPiece="",m.score=0,m.cPressed=!1}(),b.fillStyle=d,b.fillRect(0,0,p.width,p.height),k())}function k(){T(),_(m.currentShapeGrid,m.currentPosition,w[m.currentPiece].color),O(),D()}function T(){p.height=window.innerHeight,p.width=window.innerWidth,p.width/p.height<1.3&&(p.height=p.width/1.3),b.fillStyle=d,b.fillRect(0,0,p.width,p.height),h=(p.height-80)/20,f=14*h,g=(p.width-f)/2,P&&(O(),A())}function O(){const e="#737373";for(let t=0;t<m.board.length;t++){const r=m.board[t];for(let n=0;n<r.length;n++){let o;o=""===r[n]?"black":r[n];const c=[g+t*h,u+n*h];L(c[0],c[1],h-1,h-1,e,o)}}const t=[g+15*h,u],r=w[m.nextPiece].color;if(G(t,m.nextPiece,e,r),""!==m.savedPiece){const t=[g-7*h,u],r=w[m.savedPiece].color;G(t,m.savedPiece,e,r)}const n=[g+Math.floor(15*h),u+Math.floor(6*h)];L(n[0],n[1],1e3,128,d,d),b.font="24px sans-serif",b.fillStyle="black",b.textAlign="left",b.fillText("Level: "+m.level,n[0],n[1]),b.fillText("Score: "+m.score,n[0],n[1]+24+Math.floor(h/2)),b.fillText("High Score: "+U(),n[0],n[1]+48+Math.floor(h))}function G(e,t,r,n){for(let t=0;t<7;t++)for(let r=0;r<6;r++)L(e[0]+t*h,e[1]+r*h,h-1,h-1,d,d);E(w[t].shape,((t,o,c)=>{c&&L(e[0]+(t+1)*h,e[1]+(o+1)*h,h-1,h-1,r,n)}))}function L(e,t,r,n,o,c){b.lineWidth=1,b.strokeStyle=o,b.beginPath(),b.rect(e,t,r,n),b.stroke(),b.fillStyle=c,b.fillRect(e+1,t+1,r-2,n-2)}function R(e,t){E(e,((e,r,n)=>{n&&(m.board[t[0]+e][t[1]+r]="")}))}function _(e,t,r){E(e,((e,n,o)=>{o&&(m.board[t[0]+e][t[1]+n]=r)}))}function A(e=!1){b.globalAlpha=.85,b.fillStyle="white",b.fillRect(0,u+4.5*h,p.width,e?4*h:3*h),b.globalAlpha=1,b.font="48px sans-serif",b.fillStyle="black",b.textAlign="center",b.fillText("Game Over!",p.width/2,u+6*h),b.font="24px sans-serif",e?(b.fillText("Congratulations! You got a new high score!",p.width/2,u+7*h),b.fillText("Press R to play again.",p.width/2,u+8*h)):b.fillText("Press R to play again.",p.width/2,u+7*h),document.removeEventListener("keydown",S),document.addEventListener("keydown",v)}function D(){m.counter++,P=!1;let e=!1,t=!0;if(m.keysPressed.length>0){if(m.keysPressed.indexOf("ArrowDown")>=0&&M("D"),m.keysPressed.indexOf("ArrowLeft")>=0&&M("L"),m.keysPressed.indexOf("ArrowRight")>=0&&M("R"),m.keysPressed.indexOf("ArrowUp")>=0&&C(1),m.keysPressed.indexOf("Space")>=0){for(;M("D"););e=!0}if((m.keysPressed.indexOf("KeyX")>=0||m.keysPressed.indexOf("KeyZ")>=0)&&C(4),m.keysPressed.indexOf("KeyC")>=0&&!m.cPressed){R(m.currentShapeGrid,m.currentPosition);const e=m.savedPiece;m.savedPiece=m.currentPiece,""!==e?x(e):x(),m.cPressed=!0,_(m.currentShapeGrid,m.currentPosition,w[m.currentPiece].color),M("none",!1)||(P=!0),t=!1}m.keysPressed=[]}var r,n;t&&(e||m.counter%m.waitTime==0)&&(M("D")||(x(),_(m.currentShapeGrid,m.currentPosition,w[m.currentPiece].color),M("none",!1)||(P=!0)),m.counter=0),O(),P?m.score>U()?(r=m.score,(n=new Date).setTime(n.getTime()+31536e7),document.cookie="highScore="+r+";",A(!0)):A():setTimeout(D)}function C(e){const t=j(e,m.currentShapeGrid),[r,n]=function(e,t,r){switch(t){case"SmallI":return r?[0,0]:4===e.length?[1,-1]:[-1,1];case"SmallL":return r&&2===e.length?e[0][1]?[-1,0]:[1,0]:[0,0];case"SmallO":return[0,0];case"SmallS":return e.length,[0,0];case"SmallT":return 3===e.length?r?[0,0]:e[0][0]?[0,-1]:[1,0]:e[0][0]?r?[-1,0]:[-1,1]:r?[1,0]:[0,0];case"F":return[0,0];case"L":return 4===e.length?r?[0,0]:[1,-1]:r?e[0][0]&&e[1][0]?e[0][3]?[-1,0]:[1,0]:e[0][0]?[-1,0]:[1,0]:[-1,1];case"I":return r?[0,0]:5===e.length?[2,-2]:[-2,2];case"P":return 3===e.length?r?e[0][0]&&e[0][1]?[-1,0]:[1,0]:e[0][0]&&e[0][1]?[0,0]:[1,-1]:r?[0,0]:e[0][0]&&e[1][0]?[-1,0]:[0,1];case"N":return r?[0,0]:4===e.length?[1,-1]:[-1,1];case"U":return r&&2===e.length?e[0][1]?[-1,0]:[1,0]:[0,0];case"T":case"V":case"W":case"X":return[0,0];case"Y":return 4===e.length?r?[0,0]:[1,-1]:r?e[0][0]?[-1,0]:[1,0]:[-1,1];case"Z":return[0,0];default:throw"Non-piece entered to getOffsetForRotation!"}}(m.currentShapeGrid,m.currentPiece,4===e),o=m.currentPosition[0]+r,c=m.currentPosition[1]+n;let i=!1;return E(t,((e,t,r)=>{if(r){const r=o+e,n=c+t;(r>=m.board.length||n>=m.board[0].length||r<0||n<0||""!==m.fixedBoard[r][n])&&(i=!0)}})),i||(R(m.currentShapeGrid,m.currentPosition),m.currentPosition[0]=o,m.currentPosition[1]=c,m.currentShapeGrid=t,_(m.currentShapeGrid,m.currentPosition,w[m.currentPiece].color)),!i}function M(e,t=!0){let r;switch(e){case"U":r=[m.currentPosition[0],m.currentPosition[1]-1];break;case"D":r=[m.currentPosition[0],m.currentPosition[1]+1];break;case"L":r=[m.currentPosition[0]-1,m.currentPosition[1]];break;case"R":r=[m.currentPosition[0]+1,m.currentPosition[1]];break;default:r=m.currentPosition}let n=!1;return E(m.currentShapeGrid,((e,t,o)=>{if(o){const o=[r[0]+e,r[1]+t];(o[0]>=m.board.length||o[1]>=m.board[0].length||o[0]<0||o[1]<0||""!==m.fixedBoard[o[0]][o[1]])&&(n=!0)}})),!n&&t&&(R(m.currentShapeGrid,m.currentPosition),m.currentPosition=r,_(m.currentShapeGrid,m.currentPosition,w[m.currentPiece].color)),!n}function j(e,t){let r;switch(e){case 0:return t;case 1:r=I(t[0].length,t.length,!1);for(let e=0;e<t.length;e++)for(let n=0;n<t[0].length;n++)r[r.length-1-n][e]=t[e][n];return r;case 2:return j(1,j(1,t));case 3:return j(1,j(2,t));case 4:r=I(t.length,t[0].length,!1);for(let e=0;e<t.length;e++)for(let n=0;n<t[0].length;n++)r[t.length-1-e][n]=t[e][n];return r;case 5:return j(4,j(1,t));case 6:return j(4,j(2,t));case 7:return j(4,j(3,t));default:throw"Non-Transformation entered to applyTransformation"}}function E(e,t){for(let r=0;r<e.length;r++)for(let n=0;n<e[0].length;n++)t(r,n,e[r][n])}function I(e,t,r){const n=[];for(let o=0;o<e;o++){const e=[];for(let n=0;n<t;n++)e.push(r);n.push(e)}return n}function K(e){const t=[];for(let r=0;r<e.length;r++){const n=[];for(let t=0;t<e[0].length;t++)n.push(e[r][t]);t.push(n)}return t}function B(){const e=Object.keys(w);return e[Math.floor(Math.random()*e.length)]}function U(){for(var e=decodeURIComponent(document.cookie).split(";"),t=0;t<e.length;t++){var r=e[t];if(0==r.indexOf("highScore"))return parseInt(r.substring("highScore".length+1,r.length))}return 0}document.addEventListener("keydown",S),k()}},e=>{e(e.s="./src/pentris.tsx")}]);