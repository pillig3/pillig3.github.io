/*! For license information please see pentris.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["pentris"],{"./src/index.scss":(e,r,t)=>{t.r(r)},"./src/pentris.tsx":function(e,r,t){var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)Object.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r.default=e,r};Object.defineProperty(r,"__esModule",{value:!0});const o=n(t("./node_modules/react/index.js")),c=t("./node_modules/react/index.js"),s=t("./node_modules/@hot-loader/react-dom/index.js");t("./src/index.scss");const i=c.createRef();s.render(o.createElement("canvas",{id:"canvas",className:"full_canvas",tabIndex:0,ref:i}),document.querySelector("#root"));const l=40,a="#D3EDED";var h,d,u,f=!1;const g=i.current,P=g.getContext("2d");window.onresize=k;const p={SmallI:{color:"cyan",shape:[[!0],[!0],[!0],[!0]]},SmallT:{color:"magenta",shape:[[!0,!0,!0],[!1,!0,!1]]},SmallO:{color:"yellow",shape:[[!0,!0],[!0,!0]]},SmallL:{color:"blue",shape:[[!0,!1],[!0,!1],[!0,!0]]},SmallS:{color:"green",shape:[[!1,!0,!0],[!0,!0,!1]]},F:{color:"red",shape:[[!1,!0,!0],[!0,!0,!1],[!1,!0,!1]]},I:{color:"orange",shape:[[!0],[!0],[!0],[!0],[!0]]},L:{color:"lightyellow",shape:[[!0,!1],[!0,!1],[!0,!1],[!0,!0]]},N:{color:"lightgreen",shape:[[!1,!0],[!1,!0],[!0,!0],[!0,!1]]},P:{color:"lightblue",shape:[[!0,!0],[!0,!0],[!0,!1]]},T:{color:"pink",shape:[[!0,!0,!0],[!1,!0,!1],[!1,!0,!1]]},U:{color:"#9f1aff",shape:[[!0,!1,!0],[!0,!0,!0]]},V:{color:"#b3003b",shape:[[!0,!1,!1],[!0,!1,!1],[!0,!0,!0]]},W:{color:"#cc6600",shape:[[!0,!1,!1],[!0,!0,!1],[!1,!0,!0]]},X:{color:"#30b5b5",shape:[[!1,!0,!1],[!0,!0,!0],[!1,!0,!1]]},Y:{color:"#0059b3",shape:[[!0,!0,!0,!0],[!1,!0,!1,!1]]},Z:{color:"#ff667d",shape:[[!0,!0,!1],[!1,!0,!1],[!1,!0,!0]]}},b=K(),w={board:E(14,20,""),fixedBoard:E(14,20,""),currentPiece:b,currentPosition:[6,0],currentShapeGrid:p[b].shape,nextPiece:K(),keysPressed:[],counter:0,waitTime:100,level:0,linesCleared:0,savedPiece:"",score:0,cPressed:!1};function x(e=""){const r=function(){const e={length:0};for(let r=0;r<w.board[0].length;r++){let t=!0;for(let e=0;e<w.board.length;e++)if(""===w.board[e][r]){t=!1;break}t&&(e[r]=!0,e.length++)}return e}();if(r.length>0){switch(w.linesCleared+=r.length,r.length){case 1:w.score+=40*(w.level+1);break;case 2:w.score+=100*(w.level+1);break;case 3:w.score+=300*(w.level+1);break;case 4:w.score+=1200*(w.level+1);break;default:w.score+=6e3*(w.level+1)}w.linesCleared%10==0&&(w.level++,w.waitTime=Math.ceil(Math.max(100-8*w.level,20))),function(e){let r=0;const t={};for(let n=w.board[0].length-1;n>e.length-1;n--)if(0!==r||!0===e[n]){for(!0===e[n]&&!0!==t[n]&&(r++,t[n]=!0);!0===e[n-r];)!0!==t[n-r]?t[n-r]=!0:console.log("!!!The unexpected happened in removeLines()!!!"),r++;for(let e=0;e<w.board.length;e++)w.board[e][n]=w.board[e][n-r]}for(let r=0;r<e.length;r++)for(let e=0;e<w.board.length;e++)w.board[e][r]=""}(r)}w.fixedBoard=I(w.board),""!==e?w.currentPiece=e:(w.currentPiece=w.nextPiece,w.nextPiece=K()),w.currentPosition=[6,0],w.currentShapeGrid=I(p[w.currentPiece].shape),w.cPressed=!1}function S(e){switch(e.code){case"Tab":e.preventDefault();break;case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":case"Space":case"KeyX":case"KeyZ":case"KeyC":w.keysPressed.push(e.code)}}function m(e){"KeyR"===e.code&&(f=!1,document.removeEventListener("keydown",m),document.addEventListener("keydown",S),function(){const e=K();w.board=E(14,20,""),w.fixedBoard=E(14,20,""),w.currentPiece=e,w.currentPosition=[6,0],w.currentShapeGrid=p[e].shape,w.nextPiece=K(),w.keysPressed=[],w.counter=0,w.waitTime=100,w.level=0,w.linesCleared=0,w.savedPiece="",w.score=0,w.cPressed=!1}(),P.fillStyle=a,P.fillRect(0,0,g.width,g.height),y())}function y(){k(),L(w.currentShapeGrid,w.currentPosition,p[w.currentPiece].color),v(),A()}function k(){g.height=window.innerHeight,g.width=window.innerWidth,g.width/g.height<1.3&&(g.height=g.width/1.3),P.fillStyle=a,P.fillRect(0,0,g.width,g.height),h=(g.height-80)/20,d=14*h,u=(g.width-d)/2,f&&(v(),R())}function v(){const e="#737373";for(let r=0;r<w.board.length;r++){const t=w.board[r];for(let n=0;n<t.length;n++){let o;o=""===t[n]?"black":t[n];const c=[u+r*h,l+n*h];O(c[0],c[1],h-1,h-1,e,o)}}const r=[u+15*h,l],t=p[w.nextPiece].color;if(T(r,w.nextPiece,e,t),""!==w.savedPiece){const r=[u-7*h,l],t=p[w.savedPiece].color;T(r,w.savedPiece,e,t)}const n=[u+Math.floor(15*h),l+Math.floor(6*h)];O(n[0],n[1],1e3,128,a,a),P.font="24px sans-serif",P.fillStyle="black",P.textAlign="left",P.fillText("Level: "+w.level,n[0],n[1]),P.fillText("Score: "+w.score,n[0],n[1]+24+Math.floor(h/2)),P.fillText("High Score: "+j(),n[0],n[1]+48+Math.floor(h))}function T(e,r,t,n){for(let r=0;r<7;r++)for(let t=0;t<6;t++)O(e[0]+r*h,e[1]+t*h,h-1,h-1,a,a);_(p[r].shape,((r,o,c)=>{c&&O(e[0]+(r+1)*h,e[1]+(o+1)*h,h-1,h-1,t,n)}))}function O(e,r,t,n,o,c){P.lineWidth=1,P.strokeStyle=o,P.beginPath(),P.rect(e,r,t,n),P.stroke(),P.fillStyle=c,P.fillRect(e+1,r+1,t-2,n-2)}function G(e,r){_(e,((e,t,n)=>{n&&(w.board[r[0]+e][r[1]+t]="")}))}function L(e,r,t){_(e,((e,n,o)=>{o&&(w.board[r[0]+e][r[1]+n]=t)}))}function R(e=!1){P.globalAlpha=.85,P.fillStyle="white",P.fillRect(0,l+4.5*h,g.width,e?4*h:3*h),P.globalAlpha=1,P.font="48px sans-serif",P.fillStyle="black",P.textAlign="center",P.fillText("Game Over!",g.width/2,l+6*h),P.font="24px sans-serif",e?(P.fillText("Congratulations! You got a new high score!",g.width/2,l+7*h),P.fillText("Press R to play again.",g.width/2,l+8*h)):P.fillText("Press R to play again.",g.width/2,l+7*h),document.removeEventListener("keydown",S),document.addEventListener("keydown",m)}function A(){w.counter++,f=!1;let e=!1,r=!0;if(w.keysPressed.length>0){if(w.keysPressed.indexOf("ArrowDown")>=0&&D("D"),w.keysPressed.indexOf("ArrowLeft")>=0&&D("L"),w.keysPressed.indexOf("ArrowRight")>=0&&D("R"),w.keysPressed.indexOf("ArrowUp")>=0&&C(1),w.keysPressed.indexOf("Space")>=0){for(;D("D"););e=!0}if((w.keysPressed.indexOf("KeyX")>=0||w.keysPressed.indexOf("KeyZ")>=0)&&C(4),w.keysPressed.indexOf("KeyC")>=0&&!w.cPressed){G(w.currentShapeGrid,w.currentPosition);const e=w.savedPiece;w.savedPiece=w.currentPiece,""!==e?x(e):x(),w.cPressed=!0,L(w.currentShapeGrid,w.currentPosition,p[w.currentPiece].color),D("none",!1)||(f=!0),r=!1}w.keysPressed=[]}var t,n;r&&(e||w.counter%w.waitTime==0)&&(D("D")||(x(),L(w.currentShapeGrid,w.currentPosition,p[w.currentPiece].color),D("none",!1)||(f=!0)),w.counter=0),v(),f?w.score>j()?(t=w.score,(n=new Date).setTime(n.getTime()+31536e7),document.cookie="highScore="+t+";",R(!0)):R():setTimeout(A)}function C(e){const r=M(e,w.currentShapeGrid),[t,n]=function(e,r,t){switch(r){case"SmallI":return t?[0,0]:4===e.length?[1,-1]:[-1,1];case"SmallL":return t&&2===e.length?e[0][1]?[-1,0]:[1,0]:[0,0];case"SmallO":return[0,0];case"SmallS":return e.length,[0,0];case"SmallT":return 3===e.length?t?[0,0]:e[0][0]?[0,-1]:[1,0]:e[0][0]?t?[-1,0]:[-1,1]:t?[1,0]:[0,0];case"F":return[0,0];case"L":return 4===e.length?t?[0,0]:[1,-1]:t?e[0][0]&&e[1][0]?e[0][3]?[-1,0]:[1,0]:e[0][0]?[-1,0]:[1,0]:[-1,1];case"I":return t?[0,0]:5===e.length?[2,-2]:[-2,2];case"P":return 3===e.length?t?e[0][0]&&e[0][1]?[-1,0]:[1,0]:e[0][0]&&e[0][1]?[0,0]:[1,-1]:t?[0,0]:e[0][0]&&e[1][0]?[-1,0]:[0,1];case"N":return t?[0,0]:4===e.length?[1,-1]:[-1,1];case"U":return t&&2===e.length?e[0][1]?[-1,0]:[1,0]:[0,0];case"T":case"V":case"W":case"X":return[0,0];case"Y":return 4===e.length?t?[0,0]:[1,-1]:t?e[0][0]?[-1,0]:[1,0]:[-1,1];case"Z":return[0,0];default:throw"Non-piece entered to getOffsetForRotation!"}}(w.currentShapeGrid,w.currentPiece,4===e),o=w.currentPosition[0]+t,c=w.currentPosition[1]+n;let s=!1;return _(r,((e,r,t)=>{if(t){const t=o+e,n=c+r;(t>=w.board.length||n>=w.board[0].length||t<0||n<0||""!==w.fixedBoard[t][n])&&(s=!0)}})),s||(G(w.currentShapeGrid,w.currentPosition),w.currentPosition[0]=o,w.currentPosition[1]=c,w.currentShapeGrid=r,L(w.currentShapeGrid,w.currentPosition,p[w.currentPiece].color)),!s}function D(e,r=!0){let t;switch(e){case"U":t=[w.currentPosition[0],w.currentPosition[1]-1];break;case"D":t=[w.currentPosition[0],w.currentPosition[1]+1];break;case"L":t=[w.currentPosition[0]-1,w.currentPosition[1]];break;case"R":t=[w.currentPosition[0]+1,w.currentPosition[1]];break;default:t=w.currentPosition}let n=!1;return _(w.currentShapeGrid,((e,r,o)=>{if(o){const o=[t[0]+e,t[1]+r];(o[0]>=w.board.length||o[1]>=w.board[0].length||o[0]<0||o[1]<0||""!==w.fixedBoard[o[0]][o[1]])&&(n=!0)}})),!n&&r&&(G(w.currentShapeGrid,w.currentPosition),w.currentPosition=t,L(w.currentShapeGrid,w.currentPosition,p[w.currentPiece].color)),!n}function M(e,r){let t;switch(e){case 0:return r;case 1:t=E(r[0].length,r.length,!1);for(let e=0;e<r.length;e++)for(let n=0;n<r[0].length;n++)t[t.length-1-n][e]=r[e][n];return t;case 2:return M(1,M(1,r));case 3:return M(1,M(2,r));case 4:t=E(r.length,r[0].length,!1);for(let e=0;e<r.length;e++)for(let n=0;n<r[0].length;n++)t[r.length-1-e][n]=r[e][n];return t;case 5:return M(4,M(1,r));case 6:return M(4,M(2,r));case 7:return M(4,M(3,r));default:throw"Non-Transformation entered to applyTransformation"}}function _(e,r){for(let t=0;t<e.length;t++)for(let n=0;n<e[0].length;n++)r(t,n,e[t][n])}function E(e,r,t){const n=[];for(let o=0;o<e;o++){const e=[];for(let n=0;n<r;n++)e.push(t);n.push(e)}return n}function I(e){const r=[];for(let t=0;t<e.length;t++){const n=[];for(let r=0;r<e[0].length;r++)n.push(e[t][r]);r.push(n)}return r}function K(){const e=Object.keys(p);return e[Math.floor(Math.random()*e.length)]}function j(){for(var e=decodeURIComponent(document.cookie).split(";"),r=0;r<e.length;r++){var t=e[r];if(0==t.indexOf("highScore"))return parseInt(t.substring("highScore".length+1,t.length))}return 0}document.addEventListener("keydown",S),y()}},e=>{e(e.s="./src/pentris.tsx")}]);