function e(c){var b=0;return function(){return b<c.length?{done:!1,value:c[b++]}:{done:!0}}}function g(c){var b="undefined"!=typeof Symbol&&Symbol.iterator&&c[Symbol.iterator];return b?b.call(c):{next:e(c)}}var h,k,l,m,p,q=!0,r,t,u,v,w,x,y=BigInt(0),z=BigInt(1);function A(c){t=!1;q&&(B(),C(),u=u.fill(!0),x=w=!1,document.getElementById("pauseButton").innerHTML="Pause",c&&(document.getElementById("befungeDisplay").innerHTML="",document.getElementById("befungeStack").innerHTML=""));document.getElementById("runButton").innerHTML="Run";document.getElementById("runButton").onclick=function(){D()}}function D(){var c=document.getElementById("befungeCode").value;""===c?alert("No code entered."):(document.getElementById("befungeOutput").innerHTML="",document.getElementById("runButton").innerHTML="Stop",document.getElementById("runButton").onclick=function(){A(!0)},c=c.split("\n"),l=c.map(function(b){return b.split("")}),m=BigInt(l.reduce(function(b,a){return Math.max(b,a.length)},-Infinity)),p=BigInt(c.length),h=[{h:{x:BigInt(0),y:BigInt(0)},i:{x:BigInt(1),y:BigInt(0)}}],k=[[[]]],w=!1,v=[!1],t=!0,u=[!0],q?(r=document.getElementById("pauseInterval").value,setTimeout(E,r)):F())}function E(){if(t)if(u.reduce(function(a,b){return a&&b})){B();C();u=u.fill(!1);for(var c=0;c<h.length;c++){var b=h[c].h,a=h[c].i,d=k[c][k[c].length-1];if(v[c])'"'===l[b.y][b.x]?v[c]=!1:"string"===typeof l[b.y][b.x]?d.push(BigInt(l[b.y][b.x].charCodeAt(0))):"undefined"===typeof l[b.y][b.x]?d.push(BigInt(32)):d.push(l[b.y][b.x]);else if("bigint"!==typeof l[b.y][b.x])var f=G(b,a,d,c);"newPointer"===f&&(H(h[c].h,h[c].i,c),c++);"deletedPointer"===f?c--:"stopped"!==f&&H(b,a,c)}x?(w=!0,document.getElementById("pauseButton").innerHTML="Resume"):setTimeout(E,r)}else setTimeout(E)}var I=700,J=1E4;function F(){if(t){if(u.reduce(function(a,b){return a&&b}))for(var c=0;c<I;c++){u=u.fill(!1);for(var b=0;b<h.length;b++){var a=h[b].h,d=h[b].i,f=k[b][k[b].length-1],n=l[a.y][a.x];if(v[b])'"'===n?v[b]=!1:"string"===typeof n?f.push(BigInt(n.charCodeAt(0))):"undefined"===typeof n?f.push(BigInt(32)):f.push(n);else if("bigint"!==typeof n)var L=G(a,d,f,b);if(!t)return;if("newPointer"===L){var R=H(h[b].h,h[b].i,b);b++}if("deletedPointer"===L)b--;else if(a=H(a,d,b),Infinity===R||Infinity===a)c=Infinity}}setTimeout(F)}}function H(c,b,a){var d=0;do c.x=(c.x+b.x)%m,c.y=(c.y+b.y)%p,0>c.x&&(c.x=m+c.x),0>c.y&&(c.y=p+c.y),d++;while((" "===l[c.y][c.x]||"undefined"===typeof l[c.y][c.x])&&!v[a]&&d<J);if(d!=J||" "!==l[c.y][c.x]&&"undefined"!==typeof l[c.y][c.x])!1===u[a]&&(u[a]=!0);else return setTimeout(H,0,c,b,a),Infinity}function K(c){null===c?(c=document.getElementById("befungeOutput").innerHTML,document.getElementById("befungeOutput").innerHTML=6<=c.length&&"&nbsp;"===c.substring(c.length-6)?c.substring(0,c.length-6):c.substring(0,c.length-1)):document.getElementById("befungeOutput").innerHTML+=c.replace(/\n/g,"<br/>").replace(/ /g,"&nbsp;");document.getElementById("befungeOutput").scrollTop=document.getElementById("befungeOutput").scrollHeight}function M(c,b,a){0>b||0>a||("undefined"===typeof l[a]&&(l=l.concat(Array(N(a-p+z)).fill([])),p=BigInt(l.length)),"undefined"===typeof l[a][b]&&(l[a]=l[a].concat(Array(N(b-BigInt(l[a].length)+z)).fill(" ")),m=BigInt(Math.max(N(m),l[a].length))),l[a][b]=c)}function N(c){return-Number.MAX_SAFE_INTEGER<=c&&c<=Number.MAX_SAFE_INTEGER?parseInt(c.toString(10)):0}function B(){for(var c="",b={},a=g(h),d=a.next();!d.done;d=a.next())ptr=d.value,b[ptr.h.x.toString()+","+ptr.h.y.toString()]=!0;for(var f in l){for(var n in l[f])c=b[n+","+f]?c+'<span class="borderedChar" ':c+"<span ",a=l[f][n],c="string"===typeof a?"undefined"===typeof O[a]?" "===a?c+">&nbsp;":c+('style="color: lightgray">'+a):c+('style="color: '+O[a]+'">'+a):"undefined"===typeof a?c+">&nbsp;":c+'style="color: lightgray">\u00d8',c+="</span>";c+="<br/>"}document.getElementById("befungeDisplay").innerHTML=c}function C(){for(var c="",b=k[k.length-1],a=b.length-1;0<=a;a--){var d=b[a];c+="[";d=g(d);for(var f=d.next();!f.done;f=d.next())c+=f.value.toString()+" ";c+="<br/>"}document.getElementById("befungeStack").innerHTML=c}function G(c,b,a,d){switch(l[c.y][c.x]){case "q":return A(!1),"stopped";case "0":case "1":case "2":case "3":case "4":case "5":case "6":case "7":case "8":case "9":a.push(BigInt(l[c.y][c.x]));break;case "a":case "b":case "c":case "d":case "e":case "f":a.push(BigInt(l[c.y][c.x].charCodeAt(0)-87));break;case '"':v[d]=!0;break;case "$":a.pop();break;case ":":0<a.length&&a.push(a[a.length-1]);break;case "\\":1<a.length&&(b=a[a.length-1],a[a.length-1]=a[a.length-2],a[a.length-2]=b);break;case "+":1<a.length&&(b=a.pop(),d=a.pop(),a.push(d+b));break;case "*":1<a.length&&(b=a.pop(),d=a.pop(),a.push(d*b));break;case "-":1<a.length&&(b=a.pop(),d=a.pop(),a.push(d-b));break;case "/":1<a.length&&(b=a.pop(),d=a.pop(),a.push(d/b));break;case "%":1<a.length&&(b=a.pop(),d=a.pop(),b===y?a.push(y):a.push(d%b));break;case ".":0<a.length&&K(a.pop().toString()+" ");break;case ",":0<a.length&&(b=N(a.pop()),8==b?K(null):K(String.fromCharCode(b)));break;case "&":b=(b=prompt("Enter an integer"))?b.match(/-?[0-9]+/):["0"];a.push(BigInt(b[0]));break;case "~":b=prompt("Enter a character");""===b||null===b?a.push(BigInt(10)):(b=b.charCodeAt(0),a.push(BigInt(b)));break;case "!":0<a.length&&(a[a.length-1]=a[a.length-1]===y?z:y);break;case "#":c.x=(c.x+b.x)%m;c.y=(c.y+b.y)%p;0>c.x&&(c.x=m+c.x);0>c.y&&(c.y=p+c.y);break;case "<":b.x=-z;b.y=y;break;case "^":b.x=y;b.y=-z;break;case ">":b.x=z;b.y=y;break;case "v":b.x=y;b.y=z;break;case "?":switch(Math.floor(4*Math.random())){case 0:b.x=-z;b.y=y;break;case 1:b.x=y;b.y=-z;break;case 2:b.x=z;b.y=y;break;default:b.x=y,b.y=z}break;case "\u203d":for(d=a=0;0===a&&0===d;)a=Math.floor(2*Math.random()*l.length+1)-l.length,d=Math.floor(2*Math.random()*l[0].length+1)-l[0].length;b.x=BigInt(a);b.y=BigInt(d);break;case "`":1<a.length&&(b=a.pop(),d=a.pop(),a.push(d>b?z:y));break;case "|":0<a.length&&a.pop()!==y?(b.x=y,b.y=-z):(b.x=y,b.y=z);break;case "_":0<a.length&&a.pop()!==y?b.x=-z:b.x=z;b.y=y;break;case "g":1<a.length&&(b=a.pop(),d=a.pop(),"undefined"===typeof l[b]||"undefined"===typeof l[b][d]?a.push(BigInt(32)):"string"===typeof l[b][d]?a.push(BigInt(l[b][d].charCodeAt(0))):a.push(l[b][d]));break;case "p":2<a.length&&(b=a.pop(),d=a.pop(),a=a.pop(),31<a&&127>a?M(String.fromCharCode(N(a)),d,b):M(a,d,b));break;case "@":if(1===h.length)return A(!1),"stopped";h.splice(d,1);u.splice(d,1);k.splice(d,1);return"deletedPointer";case "n":a.splice(0);break;case "{":0<a.length?(b=N(a.pop()),a=a.length>=b?a.splice(a.length-b):Array(b-a.length).fill(0).concat(a.splice(0))):a=[];k[d].push(a);break;case "}":1<k[d].length&&(0<a.length&&(b=k[d][k[d].length-2],c=N(a.pop()),a.length>=c?b.splice.apply(b,[b.length,0].concat(a.splice(a.length-c))):b.splice.apply(b,[b.length,0].concat(Array(c-a.length).fill(0).concat(a)))),k[d].pop());break;case "u":if(0<a.length)for(b=N(a.pop()),c=0;c<b;c++){var f=k[d][k[d].length-2].pop();a.push("undefined"===typeof f?0:f)}break;case "x":1<a.length&&(d=a.pop(),a=a.pop(),b.y=d,b.x=a);break;case "[":a=b.x;b.x=-b.y;b.y=a;break;case "]":a=b.x;b.x=b.y;b.y=-a;break;case "w":1<a.length&&(d=a.pop(),a=a.pop(),a<d?(a=b.x,b.x=-b.y,b.y=a):a>d&&(a=b.x,b.x=b.y,b.y=-a));break;case "t":a=[];f=g(k[d]);for(var n=f.next();!n.done;n=f.next())stack=n.value,a.push(stack.slice());h.splice(d,0,{h:{x:c.x,y:c.y},i:{x:-b.x,y:-b.y}});u.splice(d,0,!1);k.splice(d,0,a);return"newPointer";case "'":c.x=(c.x+b.x)%m;c.y=(c.y+b.y)%p;0>c.x&&(c.x=m+c.x);0>c.y&&(c.y=p+c.y);"undefined"===typeof l[c.y][c.x]?a.push(BigInt(32)):"string"===typeof l[c.y][c.x]?a.push(BigInt(l[c.y][c.x].charCodeAt(0))):a.push(l[c.y][c.x]);break;case "s":c.x=(c.x+b.x)%m;c.y=(c.y+b.y)%p;0>c.x&&(c.x=m+c.x);0>c.y&&(c.y=p+c.y);0<a.length&&(a=a.pop(),31<a&&127>a?M(String.fromCharCode(N(a)),c.x,c.y):M(a,c.x,c.y));break;case "r":b.x*=-z,b.y*=-z}}var à="black",á="blue",â="limegreen",ã="purple",ä="orange",å="red",æ="cyan",O={0:à,1:à,2:à,3:à,4:à,5:à,6:à,7:à,8:à,9:à,a:à,b:à,c:à,d:à,e:à,f:à,"+":á,"-":á,"*":á,"/":á,"%":á,"!":á,"`":á,"<":â,"^":â,">":â,v:â,"?":â,_:â,"|":â,"#":â,r:â,x:â,"[":â,"]":â,w:â,":":ä,"\\":ä,$:ä,n:ä,"{":ä,"}":ä,u:ä,".":ã,",":ã,"&":ã,"~":ã,'"':ã,"'":ã,s:ã,q:å,"@":å,g:æ,p:æ,t:"magenta"},P=!1,Q=!1;window.stop=A;window.runBefunge=D;window.toggleDisplay=function(){t||x||w||(q?(q=!1,document.getElementById("stepButton").hidden=!0,document.getElementById("pauseButton").hidden=!0,document.getElementById("pauseOptions").hidden=!0,document.getElementById("display").innerHTML="",document.getElementById("displayButton").innerHTML="Show state"):(q=!0,document.getElementById("stepButton").hidden=!1,document.getElementById("pauseButton").hidden=!1,document.getElementById("pauseOptions").hidden=!1,document.getElementById("display").innerHTML='<span class="befungeText">State</span><div class="codeOutput" id="befungeDisplay"></div><div class="codeOutput" id="befungeStack"></div>',document.getElementById("displayButton").innerHTML="Hide state"))};window.pauseBefunge=function(){t&&!w?(t=!1,w=!0,document.getElementById("pauseButton").innerHTML="Resume"):w&&(x=!1,t=!0,r=document.getElementById("pauseInterval").value,w=!1,document.getElementById("pauseButton").innerHTML="Pause",setTimeout(E,0))};window.stepOnce=function(){t||w?w&&(t=x=!0,E()):(x=!0,D())};window.toggleExamples=function(){if(Q)document.getElementById("examples").innerHTML="";else{var c=new XMLHttpRequest;c.open("GET","./txt/exampleTable.txt");c.onreadystatechange=function(){document.getElementById("examples").innerHTML=c.responseText};c.send()}Q=!Q};window.putExample=function(c){var b=new XMLHttpRequest;b.open("GET","./txt/"+c+".txt");b.onreadystatechange=function(){document.getElementById("befungeCode").value=b.responseText};b.send()};window.toggleWrap=function(){P?document.getElementById("befungeOutput").classList.remove("wordwrap"):document.getElementById("befungeOutput").classList.add("wordwrap");P=!P};
