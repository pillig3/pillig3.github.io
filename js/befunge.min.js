function e(c){var b=0;return function(){return b<c.length?{done:!1,value:c[b++]}:{done:!0}}}function g(c){var b="undefined"!=typeof Symbol&&Symbol.iterator&&c[Symbol.iterator];return b?b.call(c):{next:e(c)}}var h,l,m,n,p,q=!0,r,t,u,v,w,x,y=BigInt(0),z=BigInt(1);
function A(c){t=!1;q&&(B(),u=u.fill(!0),x=w=!1,document.getElementById("pauseButton").innerHTML="Pause",c&&(document.getElementById("befungeDisplay").innerHTML="",document.getElementById("befungeStack").innerHTML=""));document.getElementById("runButton").innerHTML="Run";document.getElementById("runButton").onclick=function(){C()}}
function C(){var c=document.getElementById("befungeCode").value;""===c?alert("No code entered."):(document.getElementById("befungeOutput").innerHTML="",document.getElementById("runButton").innerHTML="Stop",document.getElementById("runButton").onclick=function(){A(!0)},c=c.split("\n"),m=c.map(function(b){return b.split("")}),n=m.reduce(function(b,a){return Math.max(b,a.length)},-Infinity),p=c.length,n=BigInt(n),p=BigInt(p),h=[{h:{x:BigInt(0),y:BigInt(0)},i:{x:BigInt(1),y:BigInt(0)}}],l=[[[]]],w=!1,
v=[!1],t=!0,u=[!0],q?(r=document.getElementById("pauseInterval").value,setTimeout(D,r)):E())}
function D(){if(t)if(u.reduce(function(a,b){return a&&b})){B();u=u.fill(!1);for(var c=0;c<h.length;c++){var b=h[c].h,a=h[c].i,d=l[c][l[c].length-1];if(v[c])'"'===m[b.y][b.x]?v[c]=!1:"string"===typeof m[b.y][b.x]?d.push(BigInt(m[b.y][b.x].charCodeAt(0))):"undefined"===typeof m[b.y][b.x]?d.push(BigInt(32)):d.push(m[b.y][b.x]);else if("bigint"!==typeof m[b.y][b.x])var f=F(b,a,d,c);"newPointer"===f&&(G(h[c].h,h[c].i,c),c++);"deletedPointer"===f?c--:"stopped"!==f&&G(b,a,c)}x?(w=!0,document.getElementById("pauseButton").innerHTML=
"Resume"):setTimeout(D,r)}else setTimeout(D)}var H=700,J=1E4;
function E(){if(t){if(u.reduce(function(a,b){return a&&b}))for(var c=0;c<H;c++){u=u.fill(!1);for(var b=0;b<h.length;b++){var a=h[b].h,d=h[b].i,f=l[b][l[b].length-1],k=m[a.y][a.x];if(v[b])'"'===k?v[b]=!1:"string"===typeof k?f.push(BigInt(k.charCodeAt(0))):"undefined"===typeof k?f.push(BigInt(32)):f.push(k);else if("bigint"!==typeof k)var I=F(a,d,f,b);if(!t)return;if("newPointer"===I){var P=G(h[b].h,h[b].i,b);b++}if("deletedPointer"===I)b--;else if(a=G(a,d,b),Infinity===P||Infinity===a)c=Infinity}}setTimeout(E)}}
function G(c,b,a){var d=0;do c.x=(c.x+b.x)%n,c.y=(c.y+b.y)%p,0>c.x&&(c.x=n+c.x),0>c.y&&(c.y=p+c.y),d++;while((" "===m[c.y][c.x]||"undefined"===typeof m[c.y][c.x])&&!v[a]&&d<J);if(d!=J||" "!==m[c.y][c.x]&&"undefined"!==typeof m[c.y][c.x])!1===u[a]&&(u[a]=!0);else return setTimeout(G,0,c,b,a),Infinity}
function K(c){document.getElementById("befungeOutput").innerHTML+=c.replace(/\n/g,"<br/>").replace(/ /g,"&nbsp;");document.getElementById("befungeOutput").scrollTop=document.getElementById("befungeOutput").scrollHeight}function L(c,b,a){0>b||0>a||("undefined"===typeof m[a]&&(m=m.concat(Array(M(a-p+z)).fill([])),p=BigInt(m.length)),"undefined"===typeof m[a][b]&&(m[a]=m[a].concat(Array(M(b-BigInt(m[a].length)+z)).fill(" ")),n=BigInt(Math.max(M(n),m[a].length))),m[a][b]=c)}
function M(c){return-Number.MAX_SAFE_INTEGER<=c&&c<=Number.MAX_SAFE_INTEGER?parseInt(c.toString(10)):0}
function B(){for(var c="",b={},a=g(h),d=a.next();!d.done;d=a.next())ptr=d.value,b[ptr.h.x.toString()+","+ptr.h.y.toString()]=!0;for(var f in m){for(var k in m[f])c=b[k+","+f]?c+'<span class="borderedChar" ':c+"<span ",a=m[f][k],c="string"===typeof a?"undefined"===typeof N[a]?" "===a?c+">&nbsp;":c+('style="color: lightgray">'+a):c+('style="color: '+N[a]+'">'+a):"undefined"===typeof a?c+">&nbsp;":c+'style="color: lightgray">\u00d8',c+="</span>";c+="<br/>"}document.getElementById("befungeDisplay").innerHTML=
c;c="";b=l[l.length-1];for(f=b.length-1;0<=f;f--){k=b[f];c+="[";k=g(k);for(a=k.next();!a.done;a=k.next())c+=a.value.toString()+" ";c+="<br/>"}document.getElementById("befungeStack").innerHTML=c}
function F(c,b,a,d){switch(m[c.y][c.x]){case "q":return A(),"stopped";case "0":case "1":case "2":case "3":case "4":case "5":case "6":case "7":case "8":case "9":a.push(BigInt(m[c.y][c.x]));break;case "a":case "b":case "c":case "d":case "e":case "f":a.push(BigInt(m[c.y][c.x].charCodeAt(0)-87));break;case '"':v[d]=!0;break;case "$":a.pop();break;case ":":0<a.length&&a.push(a[a.length-1]);break;case "\\":1<a.length&&(b=a[a.length-1],a[a.length-1]=a[a.length-2],a[a.length-2]=b);break;case "+":1<a.length&&
(b=a.pop(),d=a.pop(),a.push(d+b));break;case "*":1<a.length&&(b=a.pop(),d=a.pop(),a.push(d*b));break;case "-":1<a.length&&(b=a.pop(),d=a.pop(),a.push(d-b));break;case "/":1<a.length&&(b=a.pop(),d=a.pop(),a.push(d/b));break;case "%":1<a.length&&(b=a.pop(),d=a.pop(),b===y?a.push(y):a.push(d%b));break;case ".":0<a.length&&K(a.pop().toString()+" ");break;case ",":0<a.length&&K(String.fromCharCode(M(a.pop())));break;case "&":b=(b=prompt("Enter an integer"))?b.match(/-?[0-9]+/):["0"];a.push(BigInt(b[0]));
break;case "~":b=prompt("Enter a character");""===b||null===b?a.push(BigInt(10)):(b=b.charCodeAt(0),a.push(BigInt(b)));break;case "!":0<a.length&&(a[a.length-1]=a[a.length-1]===y?z:y);break;case "#":c.x=(c.x+b.x)%n;c.y=(c.y+b.y)%p;0>c.x&&(c.x=n+c.x);0>c.y&&(c.y=p+c.y);break;case "<":b.x=-z;b.y=y;break;case "^":b.x=y;b.y=-z;break;case ">":b.x=z;b.y=y;break;case "v":b.x=y;b.y=z;break;case "?":switch(Math.floor(4*Math.random())){case 0:b.x=-z;b.y=y;break;case 1:b.x=y;b.y=-z;break;case 2:b.x=z;b.y=y;
break;default:b.x=y,b.y=z}break;case "`":1<a.length&&(b=a.pop(),d=a.pop(),a.push(d>b?z:y));break;case "|":0<a.length&&a.pop()!==y?(b.x=y,b.y=-z):(b.x=y,b.y=z);break;case "_":0<a.length&&a.pop()!==y?b.x=-z:b.x=z;b.y=y;break;case "g":1<a.length&&(b=a.pop(),d=a.pop(),"undefined"===typeof m[b]||"undefined"===typeof m[b][d]?a.push(BigInt(32)):"string"===typeof m[b][d]?a.push(BigInt(m[b][d].charCodeAt(0))):a.push(m[b][d]));break;case "p":2<a.length&&(b=a.pop(),d=a.pop(),a=a.pop(),31<a&&127>a?L(String.fromCharCode(M(a)),
d,b):L(a,d,b));break;case "@":if(1===h.length)return A(),"stopped";h.splice(d,1);u.splice(d,1);l.splice(d,1);return"deletedPointer";case "n":a.splice(0);break;case "{":0<a.length?(b=M(a.pop()),a=a.length>=b?a.splice(a.length-b):Array(b-a.length).fill(0).concat(a.splice(0))):a=[];l[d].push(a);break;case "}":1<l[d].length&&(0<a.length&&(b=l[d][l[d].length-2],c=M(a.pop()),a.length>=c?b.splice.apply(b,[b.length,0].concat(a.splice(a.length-c))):b.splice.apply(b,[b.length,0].concat(Array(c-a.length).fill(0).concat(a)))),
l[d].pop());break;case "u":if(0<a.length)for(b=M(a.pop()),d=0;d<b;d++)c=l[d][l[d].length-2].pop(),a.push("undefined"===typeof c?0:c);break;case "x":1<a.length&&(d=a.pop(),a=a.pop(),b.y=d,b.x=a);break;case "[":a=b.x;b.x=-b.y;b.y=a;break;case "]":a=b.x;b.x=b.y;b.y=-a;break;case "w":1<a.length&&(d=a.pop(),a=a.pop(),a<d?(a=b.x,b.x=-b.y,b.y=a):a>d&&(a=b.x,b.x=b.y,b.y=-a));break;case "t":a=[];for(var f=g(l[d]),k=f.next();!k.done;k=f.next())stack=k.value,a.push(stack.slice());h.splice(d,0,{h:{x:c.x,y:c.y},
i:{x:-b.x,y:-b.y}});u.splice(d,0,!1);l.splice(d,0,a);return"newPointer";case "'":c.x=(c.x+b.x)%n;c.y=(c.y+b.y)%p;0>c.x&&(c.x=n+c.x);0>c.y&&(c.y=p+c.y);"undefined"===typeof m[c.y][c.x]?a.push(BigInt(32)):"string"===typeof m[c.y][c.x]?a.push(BigInt(m[c.y][c.x].charCodeAt(0))):a.push(m[c.y][c.x]);break;case "s":c.x=(c.x+b.x)%n;c.y=(c.y+b.y)%p;0>c.x&&(c.x=n+c.x);0>c.y&&(c.y=p+c.y);0<a.length&&(a=a.pop(),31<a&&127>a?L(String.fromCharCode(M(a)),c.x,c.y):L(a,c.x,c.y));break;case "r":b.x*=-z,b.y*=-z}}
var N={0:"black",1:"black",2:"black",3:"black",4:"black",5:"black",6:"black",7:"black",8:"black",9:"black",a:"black",b:"black",c:"black",d:"black",e:"black",f:"black","+":"blue","-":"blue","*":"blue","/":"blue","%":"blue","!":"blue","`":"blue","<":"limegreen","^":"limegreen",">":"limegreen",v:"limegreen","?":"limegreen",_:"limegreen","|":"limegreen","#":"limegreen",r:"limegreen",x:"limegreen","[":"limegreen","]":"limegreen",w:"limegreen",":":"orange","\\":"orange",$:"orange",n:"orange","{":"orange",
"}":"orange",u:"orange",".":"purple",",":"purple","&":"purple","~":"purple",'"':"purple","'":"purple",s:"purple",q:"red","@":"red",g:"cyan",p:"cyan",t:"magenta"},O=!1,Q={1:'"!dlrow olleH"v,_@\n              >:^',2:'#vt#vt#vt#vt#vt#vr\n v  v  v  v  v  "\n v  v  v  v  v  e\n v  v  v  v  "  H\n v  v  v  v  l  "\n v  v  v  "  l\n v  v  v     "\n v  v  "  o\n v  v  o  "\n v  "  w\n v  l  "\n "  r\n !  "\n d\n "\n>>>>>>>>>>>>>>>>>>>>>,,@',3:"&:>00pv\n  *   1\n  g   -\n  0   :\n.@^0 :_00g",4:'&:." =",,: v\nv          _0.@\n  ;factor;\n>00p>00g1-#v_>:#._@\n^/\\g00:<   2\n     >   1+v\n     ^_^#%<:\n          \\0\n          g0\n          ^<',
5:">            a         4         v\n calculates n^ choose k^\nv                                < makes k>n-k\n>:1aa*p \\ :0aa*p \\ -: 1aa*g \\`#v_ 1aa*g2av\n n-k!                    vp*aa2<vp*aa1p*a<\nv:g*aa2     tv#     tv#  <      <\n>3aa*p1-:v    v:g*aa0<        >16aa*p@\n^ *g*aa3:_v   >4aa*p:1aa*g1+-v\n   @p*aa51<   ^ * g*aa4 : -1 _^\n<v -1  g*aa5 <\n$\n >6aa*g 1-v\n^      _v#<\n^       _4aa*g3aa*g/.q"};window.stop=A;window.runBefunge=C;
window.toggleDisplay=function(){t||x||w||(q?(q=!1,document.getElementById("stepButton").hidden=!0,document.getElementById("pauseButton").hidden=!0,document.getElementById("pauseOptions").hidden=!0,document.getElementById("display").innerHTML="",document.getElementById("displayButton").innerHTML="Show state"):(q=!0,document.getElementById("stepButton").hidden=!1,document.getElementById("pauseButton").hidden=!1,document.getElementById("pauseOptions").hidden=!1,document.getElementById("display").innerHTML=
'<span class="befungeText">State</span><div class="codeOutput" id="befungeDisplay"></div><div class="codeOutput" id="befungeStack"></div>',document.getElementById("displayButton").innerHTML="Hide state"))};window.pauseBefunge=function(){t&&!w?(t=!1,w=!0,document.getElementById("pauseButton").innerHTML="Resume"):w&&(x=!1,t=!0,r=document.getElementById("pauseInterval").value,w=!1,document.getElementById("pauseButton").innerHTML="Pause",setTimeout(D,0))};
window.stepOnce=function(){t||w?w&&(t=x=!0,D()):(x=!0,C())};
window.toggleExamples=function(){document.getElementById("examples").innerHTML=O?"":'<table id="exampleTable">\n      <colgroup>\n        <col style="width:calc(100%/5)">\n        <col style="width:calc(100%/5)">\n        <col style="width:calc(100%/5)">\n        <col style="width:calc(100%/5)">\n        <col style="width:calc(100%/5)">\n      </colgroup>\n      <tr>\n        <td class="clickable" onclick="putExample(1)">Hello world!</td>\n        <td class="clickable" onclick="putExample(3)">Factorial</td>\n        <td class="clickable" onclick="putExample(4)">Factor</td>\n        <td class="clickable" onclick="putExample(2)">Hello world! 2.0</td>\n        <td class="clickable" onclick="putExample(5)">Binomial</td>\n      </tr>\n    </table>\n    <p></p>';O=
!O};window.putExample=function(c){document.getElementById("befungeCode").value=Q[c]};
