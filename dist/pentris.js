/*! For license information please see pentris.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["pentris"],{"./src/index.scss":(e,t,r)=>{r.r(t)},"./src/pentris.tsx":function(e,t,r){var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const o=n(r("./node_modules/react/index.js")),c=r("./node_modules/react/index.js"),s=r("./node_modules/@hot-loader/react-dom/index.js");r("./src/index.scss");const i=c.createRef();s.render(o.createElement("canvas",{id:"canvas",className:"full_canvas",tabIndex:0,ref:i}),document.querySelector("#root"));const l=40,a="#D3EDED";var h,u,d,f=!1;const g=i.current,P=g.getContext("2d");window.onresize=v;const p={SmallI:{color:"cyan",shape:[[!0],[!0],[!0],[!0]]},SmallT:{color:"magenta",shape:[[!0,!0,!0],[!1,!0,!1]]},SmallO:{color:"yellow",shape:[[!0,!0],[!0,!0]]},SmallL:{color:"blue",shape:[[!0,!1],[!0,!1],[!0,!0]]},SmallS:{color:"green",shape:[[!1,!0,!0],[!0,!0,!1]]},F:{color:"red",shape:[[!1,!0,!0],[!0,!0,!1],[!1,!0,!1]]},I:{color:"orange",shape:[[!0],[!0],[!0],[!0],[!0]]},L:{color:"lightyellow",shape:[[!0,!1],[!0,!1],[!0,!1],[!0,!0]]},N:{color:"lightgreen",shape:[[!1,!0],[!1,!0],[!0,!0],[!0,!1]]},P:{color:"lightblue",shape:[[!0,!0],[!0,!0],[!0,!1]]},T:{color:"pink",shape:[[!0,!0,!0],[!1,!0,!1],[!1,!0,!1]]},U:{color:"#9f1aff",shape:[[!0,!1,!0],[!0,!0,!0]]},V:{color:"#b3003b",shape:[[!0,!1,!1],[!0,!1,!1],[!0,!0,!0]]},W:{color:"#cc6600",shape:[[!0,!1,!1],[!0,!0,!1],[!1,!0,!0]]},X:{color:"#30b5b5",shape:[[!1,!0,!1],[!0,!0,!0],[!1,!0,!1]]},Y:{color:"#0059b3",shape:[[!0,!0,!0,!0],[!1,!0,!1,!1]]},Z:{color:"#ff667d",shape:[[!0,!0,!1],[!1,!0,!1],[!1,!0,!0]]}};class x{constructor(e,t){this.x=e,this.y=t}}const y=j(),w={board:I(14,20,""),fixedBoard:I(14,20,""),currentPiece:y,currentPosition:new x(6,0),currentShapeGrid:p[y].shape,nextPiece:j(),keysPressed:[],counter:0,waitTime:100,level:0,linesCleared:0,savedPiece:"",score:0,cPressed:!1};function b(e=""){const t=function(){const e=[];for(let t=0;t<w.board[0].length;t++){let r=!0;for(let e=0;e<w.board.length&&(""===w.board[e][t]&&(r=!1),r);e++);r&&e.push(t)}return e}();if(t.length>0){switch(w.linesCleared+=t.length,t.length){case 1:w.score+=40*(w.level+1);break;case 2:w.score+=100*(w.level+1);break;case 3:w.score+=300*(w.level+1);break;case 4:w.score+=1200*(w.level+1);break;default:w.score+=6e3*(w.level+1)}w.linesCleared%10==0&&(w.level++,w.waitTime=Math.ceil(Math.max(100-8*w.level,20))),function(e){for(let t=e[e.length-1];t>e.length-1;t--)for(let r=0;r<w.board.length;r++)w.board[r][t]=w.board[r][t-e.length];for(let t=0;t<e.length;t++)for(let e=0;e<w.board.length;e++)w.board[e][t]=""}(t)}w.fixedBoard=K(w.board),""!==e?w.currentPiece=e:(w.currentPiece=w.nextPiece,w.nextPiece=j()),w.currentPosition=new x(6,0),w.currentShapeGrid=K(p[w.currentPiece].shape),w.cPressed=!1}function S(e){switch(e.code){case"Tab":e.preventDefault();break;case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":case"Space":case"KeyX":case"KeyZ":case"KeyC":w.keysPressed.push(e.code)}}function m(e){"KeyR"===e.code&&(f=!1,document.removeEventListener("keydown",m),document.addEventListener("keydown",S),function(){const e=j();w.board=I(14,20,""),w.fixedBoard=I(14,20,""),w.currentPiece=e,w.currentPosition=new x(6,0),w.currentShapeGrid=p[e].shape,w.nextPiece=j(),w.keysPressed=[],w.counter=0,w.waitTime=100,w.level=0,w.linesCleared=0,w.savedPiece="",w.score=0,w.cPressed=!1}(),P.fillStyle=a,P.fillRect(0,0,g.width,g.height),k())}function k(){v(),R(w.currentShapeGrid,w.currentPosition,p[w.currentPiece].color),T(),C()}function v(){g.height=window.innerHeight,g.width=window.innerWidth,g.width/g.height<1.3&&(g.height=g.width/1.3),P.fillStyle=a,P.fillRect(0,0,g.width,g.height),h=(g.height-80)/20,u=14*h,d=(g.width-u)/2,f&&(T(),A())}function T(){const e="#737373";for(let t=0;t<w.board.length;t++){const r=w.board[t];for(let n=0;n<r.length;n++){let o;o=""===r[n]?"black":r[n];const c=new x(d+t*h,l+n*h);G(c.x,c.y,h-1,h-1,e,o)}}const t=new x(d+15*h,l),r=p[w.nextPiece].color;if(O(t,w.nextPiece,e,r),""!==w.savedPiece){const t=new x(d-7*h,l),r=p[w.savedPiece].color;O(t,w.savedPiece,e,r)}const n=new x(d+Math.floor(15*h),l+Math.floor(6*h));G(n.x,n.y,1e3,128,a,a),P.font="24px sans-serif",P.fillStyle="black",P.textAlign="left",P.fillText("Level: "+w.level,n.x,n.y),P.fillText("Score: "+w.score,n.x,n.y+24+Math.floor(h/2)),P.fillText("High Score: "+U(),n.x,n.y+48+Math.floor(h))}function O(e,t,r,n){for(let t=0;t<7;t++)for(let r=0;r<6;r++){const n=new x(e.x+t*h,e.y+r*h);G(n.x,n.y,h-1,h-1,a,a)}E(p[t].shape,((t,o,c)=>{if(c){const c=new x(e.x+(t+1)*h,e.y+(o+1)*h);G(c.x,c.y,h-1,h-1,r,n)}}))}function G(e,t,r,n,o,c){P.lineWidth=1,P.strokeStyle=o,P.beginPath(),P.rect(e,t,r,n),P.stroke(),P.fillStyle=c,P.fillRect(e+1,t+1,r-2,n-2)}function L(e,t){E(e,((e,r,n)=>{if(n){const n=new x(t.x+e,t.y+r);w.board[n.x][n.y]=""}}))}function R(e,t,r){E(e,((e,n,o)=>{if(o){const o=new x(t.x+e,t.y+n);w.board[o.x][o.y]=r}}))}function A(e=!1){P.globalAlpha=.85,P.fillStyle="white",P.fillRect(0,l+4.5*h,g.width,e?4*h:3*h),P.globalAlpha=1,P.font="48px sans-serif",P.fillStyle="black",P.textAlign="center",P.fillText("Game Over!",g.width/2,l+6*h),P.font="24px sans-serif",e?(P.fillText("Congratulations! You got a new high score!",g.width/2,l+7*h),P.fillText("Press R to play again.",g.width/2,l+8*h)):P.fillText("Press R to play again.",g.width/2,l+7*h),document.removeEventListener("keydown",S),document.addEventListener("keydown",m)}function C(){w.counter++,f=!1;let e=!1,t=!0;if(w.keysPressed.length>0){if(w.keysPressed.indexOf("ArrowDown")>=0&&M("D"),w.keysPressed.indexOf("ArrowLeft")>=0&&M("L"),w.keysPressed.indexOf("ArrowRight")>=0&&M("R"),w.keysPressed.indexOf("ArrowUp")>=0&&D(1),w.keysPressed.indexOf("Space")>=0){for(;M("D"););e=!0}if((w.keysPressed.indexOf("KeyX")>=0||w.keysPressed.indexOf("KeyZ")>=0)&&D(4),w.keysPressed.indexOf("KeyC")>=0&&!w.cPressed){L(w.currentShapeGrid,w.currentPosition);const e=w.savedPiece;w.savedPiece=w.currentPiece,""!==e?b(e):b(),w.cPressed=!0,R(w.currentShapeGrid,w.currentPosition,p[w.currentPiece].color),M("none",!1)||(f=!0),t=!1}w.keysPressed=[]}var r,n;t&&(e||w.counter%w.waitTime==0)&&(M("D")||(b(),R(w.currentShapeGrid,w.currentPosition,p[w.currentPiece].color),M("none",!1)||(f=!0)),w.counter=0),T(),f?w.score>U()?(r=w.score,(n=new Date).setTime(n.getTime()+31536e7),document.cookie="highScore="+r+";",A(!0)):A():setTimeout(C)}function D(e){const t=_(e,w.currentShapeGrid),[r,n]=function(e,t,r){switch(t){case"SmallI":return r?[0,0]:4===e.length?[1,-1]:[-1,1];case"SmallL":return r&&2===e.length?e[0][1]?[-1,0]:[1,0]:[0,0];case"SmallO":return[0,0];case"SmallS":return e.length,[0,0];case"SmallT":return 3===e.length?r?[0,0]:e[0][0]?[0,-1]:[1,0]:e[0][0]?r?[-1,0]:[-1,1]:r?[1,0]:[0,0];case"F":return[0,0];case"L":return 4===e.length?r?[0,0]:[1,-1]:r?e[0][0]&&e[1][0]?e[0][3]?[-1,0]:[1,0]:e[0][0]?[-1,0]:[1,0]:[-1,1];case"I":return r?[0,0]:5===e.length?[2,-2]:[-2,2];case"P":return 3===e.length?r?e[0][0]&&e[0][1]?[-1,0]:[1,0]:e[0][0]&&e[0][1]?[0,0]:[1,-1]:r?[0,0]:e[0][0]&&e[1][0]?[-1,0]:[0,1];case"N":return r?[0,0]:4===e.length?[1,-1]:[-1,1];case"U":return r&&2===e.length?e[0][1]?[-1,0]:[1,0]:[0,0];case"T":case"V":case"W":case"X":return[0,0];case"Y":return 4===e.length?r?[0,0]:[1,-1]:r?e[0][0]?[-1,0]:[1,0]:[-1,1];case"Z":return[0,0];default:throw"Non-piece entered to getOffsetForRotation!"}}(w.currentShapeGrid,w.currentPiece,4===e),o=w.currentPosition.x+r,c=w.currentPosition.y+n;let s=!1;return E(t,((e,t,r)=>{if(r){const r=new x(o+e,c+t);(r.x>=w.board.length||r.y>=w.board[0].length||r.x<0||r.y<0||""!==w.fixedBoard[r.x][r.y])&&(s=!0)}})),s||(L(w.currentShapeGrid,w.currentPosition),w.currentPosition.x=o,w.currentPosition.y=c,w.currentShapeGrid=t,R(w.currentShapeGrid,w.currentPosition,p[w.currentPiece].color)),!s}function M(e,t=!0){let r;switch(e){case"U":r=new x(w.currentPosition.x,w.currentPosition.y-1);break;case"D":r=new x(w.currentPosition.x,w.currentPosition.y+1);break;case"L":r=new x(w.currentPosition.x-1,w.currentPosition.y);break;case"R":r=new x(w.currentPosition.x+1,w.currentPosition.y);break;default:r=w.currentPosition}let n=!1;return E(w.currentShapeGrid,((e,t,o)=>{if(o){const o=new x(r.x+e,r.y+t);(o.x>=w.board.length||o.y>=w.board[0].length||o.x<0||o.y<0||""!==w.fixedBoard[o.x][o.y])&&(n=!0)}})),!n&&t&&(L(w.currentShapeGrid,w.currentPosition),w.currentPosition=r,R(w.currentShapeGrid,w.currentPosition,p[w.currentPiece].color)),!n}function _(e,t){let r;switch(e){case 0:return t;case 1:r=I(t[0].length,t.length,!1);for(let e=0;e<t.length;e++)for(let n=0;n<t[0].length;n++)r[r.length-1-n][e]=t[e][n];return r;case 2:return _(1,_(1,t));case 3:return _(1,_(2,t));case 4:r=I(t.length,t[0].length,!1);for(let e=0;e<t.length;e++)for(let n=0;n<t[0].length;n++)r[t.length-1-e][n]=t[e][n];return r;case 5:return _(4,_(1,t));case 6:return _(4,_(2,t));case 7:return _(4,_(3,t));default:throw"Non-Transformation entered to applyTransformation"}}function E(e,t){for(let r=0;r<e.length;r++)for(let n=0;n<e[0].length;n++)t(r,n,e[r][n])}function I(e,t,r){const n=[];for(let o=0;o<e;o++){const e=[];for(let n=0;n<t;n++)e.push(r);n.push(e)}return n}function K(e){const t=[];for(let r=0;r<e.length;r++){const n=[];for(let t=0;t<e[0].length;t++)n.push(e[r][t]);t.push(n)}return t}function j(){const e=Object.keys(p);return e[Math.floor(Math.random()*e.length)]}function U(){for(var e=decodeURIComponent(document.cookie).split(";"),t=0;t<e.length;t++){var r=e[t];if(0==r.indexOf("highScore"))return parseInt(r.substring("highScore".length+1,r.length))}return 0}document.addEventListener("keydown",S),k()}},e=>{e(e.s="./src/pentris.tsx")}]);